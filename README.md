# FramedScreenshotsTool

This package turns the Framed Screenshots workflow into a reusable CLI + SwiftPM command plugin that can install a workspace-local tooling package (`FramedScreenshots`). The local package exposes:

- `framed-screenshots` – an ArgumentParser CLI that lists, renders, and (optionally) uploads App Store screenshots per localisation/platform.
- `FramedScreenshotsKit` – SwiftUI helpers (registry, overlays, text styles, marketing badges) designed for preview-friendly screenshot design.
- A generated mise task that wraps installation + rendering so a host workspace can run `mise run framed-screenshots …` without boilerplate.

> **Platform requirement:** the package manifest targets macOS 26 and Swift tools 5.9. Use Xcode 17.1 (or newer) with the macOS 26 SDK to build and preview the templates.

The external package you are reading ships three top-level targets:

- `InstallerCore` – pure Swift file-system orchestration that installs/updates the local tool package, copies template sources, and ensures idempotence.
- `FramedScreenshotsToolCLI` – wraps `InstallerCore` with user-friendly ArgumentParser commands (`install-framed-screenshots-tool`, `enable-app-store-connect`, etc.).
- `InstallFramedScreenshotsToolPlugin` + companion App Store Connect command plugins – surface the installer/credential flow inside Xcode and via `swift package`.

## Installing into a workspace

```bash
# from the root of the host workspace
swift run framed-screenshots-tool install-framed-screenshots-tool --workspace .
```

The installer discovers the workspace root, creates `Tools/FramedScreenshots` (or `FramedScreenshots/` if `Tools/` is missing), and adds a mise task that proxies to the local CLI. Re-running the command is idempotent; generated sections are wrapped in `// BEGIN/END GENERATED BY FramedScreenshotsTool` markers.

Once installed you can render screenshots via the generated CLI or mise task:

```bash
mise run framed-screenshots -- --workspace . --out Screenshots
```

The CLI auto-discovers the app's `.lproj` localisations, renders screenshots for each locale, and (optionally) uploads to App Store Connect. Localisation metadata is pulled from Info.plist + Xcode project settings, so adding/removing a locale is automatically reflected the next time you run the renderer.

Every render emits `Screenshots/framed-screenshots-report.html`, a lightweight gallery grouped by device/resolution so you can quickly review the final PNGs before pushing to App Store Connect.

## FrameIt assets (coloured devices included)

Frame assets are cached under `Tools/FrameItCache/`. The CLI/mise task automatically pulls the upstream Fastlane FrameIt archive the first time you render. You can layer in extra frames (e.g. Cosmic Orange devices) by:

- Dropping `.png` or `.zip` bundles into `FrameItExtras/` (checked automatically by the mise task and copied into `FrameItCache/frameit-frames-master/Colored/`),
- Passing `--frame-archive <path-or-url>` to the CLI, and/or
- Setting `FRAMED_SCREENSHOTS_FRAME_ARCHIVES` or adding a `FrameItAdditionalArchives.json` array to the workspace root.

All three mechanisms merge without duplication, so the local cache converges no matter how you provide assets. The generated mise task reports which archives were ingested and where the final Cosmic Orange (or other tinted) frames land so you can reference them from custom layouts.

## Preview-friendly SwiftUI components

The generated `FramedScreenshotsKit` includes:

- `HeroText(style: .exciting())` – a TextRenderer-powered italic treatment with bold stroke outlines tuned for the straight-line “App Drama” look, plus optional gradient fill when you pass `.exciting(fill: .gradient)`.
- `HeroText(style: .wavy())` – a slanted, serpentine variant that keeps the animated baseline and gradient fill from earlier revisions.
- `HighlightsText` – exposes a `HighlightMark` custom attribute that knocks out text and paints a tilted rounded rectangle per highlight span, supporting multi-line ranges and preview mode.
- `FocusedScreenshotOverlay` – detects coloured borders produced by UI tests, crops the focused polygon, zooms it by a configurable amount, and overlays it with optional dimming, drop shadow, and frame border styles. Missing screenshots automatically degrade to placeholders so design previews keep working.
- `MarketingBadge` and friends – reusable headline/subtitle stacks with optional footers for marketing copy.

All of the above ship with SwiftUI previews under `DesignPreviews.swift`, so you can tweak styling in Xcode without running UI tests first.

## App Store Connect credentials

`framed-screenshots` can upload rendered screenshots directly via [appstoreconnect-swift-sdk](https://github.com/AvdLee/appstoreconnect-swift-sdk). Credentials are stored in the macOS Keychain per workspace path:

```bash
framed-screenshots-tool enable-app-store-connect --workspace .
```

You will be prompted for:

- API Key ID (`ASC_KEY_ID`)
- Issuer ID (`ASC_ISSUER_ID`)
- App Store Connect App ID (`ASC_APP_ID`)
- Platform (`ios`, `macos`, or `appletvos`)
- Optional version string to pin uploads
- The `.p8` private key contents

Credentials can also be managed through the **Enable/Disable App Store Connect Uploads** command plugins under Xcode ➝ Package Commands. CI environments can bypass the keychain and rely on environment variables (`ASC_KEY_ID`, `ASC_ISSUER_ID`, `ASC_PRIVATE_KEY`, `ASC_APP_ID`, `ASC_PLATFORM`, `ASC_APP_VERSION`).

Uploads are skipped automatically (with an explanatory warning) when credentials are missing or the target app version is not eligible (e.g. already in review).

## Development workflow

- `swift test` runs InstallerCore unit tests plus an end-to-end copy of `Examples/FramedScreenshotsDemo` that exercises install → render → cache flow (including extra frame archives).
- `mise run install-tool` inside the example workspace installs the local package and injects demo catalog entries.
- The repo tracks `SPEC.md` as a living requirements log; update it as features converge.

## Next steps

The remaining work in the spec focuses on polishing the TextRenderer-based typography previews, rounding out the App Store Connect uploader UX, expanding documentation, and broadening end-to-end coverage (workspace vs. project install paths plus full xcodebuild-driven capture).
