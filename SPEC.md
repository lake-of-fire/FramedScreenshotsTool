# FramedScreenshotsTool Refactor v2 — Requirements Log

_Last updated: November 3, 2025_

This document tracks the agreed behaviour for the external Swift package `FramedScreenshotsTool`, the generated workspace-local package `FramedScreenshots`, helper tooling, and associated workflows. Use it to verify convergence and to resume work.

## 1. Previously Delivered Scope

- External package roles
  - `InstallerCore` library encapsulates file-system orchestration and templating.
  - `FramedScreenshotsToolCLI` executable surfaces `framed-screenshots-tool install-framed-screenshots-tool` with arguments: `--workspace`, `--tool-folder`, `--task-name`, `--task-dir`, `--dry-run`, `--force`, `--verbose`, `--no-mise`.
  - CLI also exposes `enable-app-store-connect` / `disable-app-store-connect` to manage App Store Connect credentials in the macOS keychain (non-interactive flags supported for tool automation).
  - `InstallFramedScreenshotsToolPlugin` SwiftPM/Xcode command plugin delegates to `InstallerCore`.
  - Additional Xcode/SwiftPM command plugins provide **Enable App Store Connect Uploads** / **Disable App Store Connect Uploads**, prompting for credentials and forwarding to the CLI for secure keychain storage.
  - Tests ensure convergence, `.force` behaviour, and dry-run safety.
- Generated workspace package `FramedScreenshots`
  - Ships `FramedScreenshotsKit` library plus `framed-screenshots` CLI.
  - CLI enumerates registered views (`--list`) or renders to directory (`--out`).
  - Templates use generated markers (`// BEGIN/END GENERATED BY FramedScreenshotsTool`).
  - `mise` task script proxies to installer/CLI and respects generated blocks.
- Example workspace `Examples/FramedScreenshotsDemo`
  - Configured with Tuist to target iPhone, iPad, and macOS destinations while depending on the workspace-local `FramedScreenshots` package.citeturn0search0turn0search3
  - Ships a `mise` recipe (`mise.toml`) and script (`Scripts/apply_demo_catalog.swift`) that install the tool and inject demo catalog entries for automated previews.
- Operational guarantees
  - Installer auto-discovers workspace root (prefers `Tools/FramedScreenshots` fallback `FramedScreenshots/`).
  - Writes `.bak.<timestamp>` once per managed file prior to first mutation.
  - Idempotent reruns: convergence without duplicate entries and preservation of user code outside generated blocks.

## 2. New Requirements (to implement next)

1. **SwiftUI Previews & Placeholders**
   - ✅ `FocusedScreenshotOverlay` + `ViewPNGWriter` ship placeholder fallbacks so previews render when screenshots are missing, and `DesignPreviews.swift` covers framed compositions for rapid iteration.

2. **Frame Asset Automation**
   - ✅ Installer + CLI expose a shared `FrameItAssetPreparer` that downloads FrameIt archives into a cache, honours re-runs, and can ingest additional archives from env, JSON manifest, or CLI `--frame-archive` flags.
   - ✅ Documentation (README + INSTALL template + example workflow) now calls out `FrameItExtras/`, CLI flags, and environment variables for coloured presets such as Cosmic Orange devices, including where assets land inside the cache.

3. **Focused Element Zoom Overlay**
   - Provide a reusable SwiftUI view (`FocusedScreenshotOverlay` TBD) that:
     - Accepts screenshot name, border colour (used during UI tests), zoom percentage, optional dimming (enum: `dimmed`, `dimmed(amount:)`, `undimmed`), optional drop-shadow config, optional border styling.
     - Loads screenshots from UI-test output; when missing, degrades gracefully for previews.
     - Detects the polygon corresponding to the given border colour, masks external pixels, and produces a transparent cut-out layer.
     - Overlays the zoomed focus area on the base screenshot (centered on polygon centroid) and optionally dims the background.
   - Tests in this repo must exercise the colour-detection and masking pipeline end-to-end with synthetic images.

4. **Reusable Text & Badge Components**
   - ✅ `HeroText` uses `TextRenderer` to shear/lift glyphs, apply gradient stroke/fill, and render previews with `AttributedString` support.
   - ✅ `HighlightsText` exposes `HighlightMark` attributes for the tilted knockout highlight effect; previews demonstrate multiple highlight variants.
   - ✅ Marketing badge view and preview scaffolding land inside the generated package.

5. **Localization Matrix Rendering**
   - Automatically discover project localisations and run screenshot capture & framing per locale. Orchestrate generation matrix so each localisation obtains the correct screenshot set.

6. **App Store Connect Upload**
   - Integrate [AppStoreConnect Swift SDK](https://github.com/AvdLee/appstoreconnect-swift-sdk) to push generated screenshots by localisation for versions not yet in review. Provide warnings and skip upload when credentials/config are missing.

7. **Preview-Friendly Fallbacks**
   - ✅ Templates ship with previews for the hero text, highlights, marketing badge, and focused overlay using placeholder screenshots and sample attributed strings so design-time tweaking works without captured assets.

8. **Documentation & Tests**
   - ✅ Added unit coverage for `FrameItAssetPreparer` ingestion paths and ensured the e2e render test remains green.
   - ✅ README + INSTALL template document the keychain flow, localisation matrix behaviour, coloured frame ingestion, CLI/mise guidance, and the generated HTML review report.
   - ❏ Provide xcodebuild-driven UI test capture coverage (currently stubbed by `--skip-capture`).

## 3. Outstanding Questions / TODO

- Decide local caching layout for FrameIt assets (e.g. `Tools/FramedScreenshots/Resources/FrameIt`).
- Clarify configuration surface for App Store Connect credentials (document macOS keychain usage, env var fallbacks, and multi-workspace behaviour).
- Define how localisation discovery hooks into existing UI test pipelines (target naming conventions, derived data locations).
- Track remaining automation for xcodebuild-driven capture + App Store Connect uploader polish once credential mocks land.
